openapi: 3.1.0

info:
  title: Postcrunch
  description: 'A social media platform where we crunch others post and share ours.'
  version: 1.0.0
  contact:
    name: Nguyen Pham
    email: nguyenminhpham24@gmail.com

servers:
  - url: https://github.com/nguyepham
    description: Development server

tags:
  - name: user
    description: Everything about users and accounts.
  - name: newsfeed
    description: CRUD operations with the newsfeed.
  - name: post
    description: CRUD operations with a post.
  - name: comment
    description: CRUD operations with a comment.

paths:

  /api/v1/home:
    get:
      description: The demo page.
      operationId: fetchDemo
      responses:
        200:
          content:
            application/json:
              schema:
                type: string

  /api/v1/newsfeed:
    get:
      tags:
        - newsfeed
      description: Fetch the Postcrunch newsfeed.
      operationId: getNewsfeed
      responses:
        200:
          description: Fetched successfully.
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Newsfeed'
        401:
          $ref: '#/components/responses/Unauthorized'
        404:
          $ref: '#/components/responses/NotFound'
        500:
          $ref: '#/components/responses/InternalServerError'

components:

  responses:
    Unauthorized:
      description: Access token is missing or invalid.
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/ErrorResponse'

    NotFound:
      description: The request resources not found.
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/ErrorResponse'

    InternalServerError:
      description: An unexpected error occurred on the server.
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/ErrorResponse'

  schemas:
    User:
      type: object
      description: A Postcrunch user.
      required:
        - username
        - password
      properties:
        username:
          type: string
          description: The account's username used as the default display name.
        name:
          type: string
          description: The display name of the user.
        password:
          type: string
          description: The account's password.
        email:
          type: string
          description: The user's email.
          format: email
        dateOfBirth:
          type: string
          description: The user's birthday.
          format: date-time
        gender:
          type: string
          description: The user's gender.

    Newsfeed:
      type: object
      description: The Postcrunch newsfeed.
      properties:
        lastFetched:
          type: string
          description: The last time the newsfeed was fetched.
          format: date-time
        contents:
          type: array
          description: The list of contents on the newsfeed.
          items:
            $ref: '#/components/schemas/Content'

    Content:
      type: object
      description: A content on the newsfeed (post or comment).
      properties:
        id:
          type: string
          description: The comment's id.
        isAPost:
          type: boolean
          description: Whether this content is a post or not.
        numOfReports:
          type: integer
          description: The number of times the content has been reported.
          format: int32
        createdAt:
          type: string
          description: The time the content was added.
          format: date-time
        author:
          description: The user who created the content.
          $ref: '#/components/schemas/User'
        votes:
          type: array
          description: List of up/down votes made on the content.
          items:
            $ref: '#/components/schemas/Vote'
        text:
          type: string
          description: The text in the content.

    Post:
      allOf:
        - $ref: '#/components/schemas/Content'
        - type: object
          description: A Postcrunch post.
          properties:
            comments:
              type: array
              description: List of comments made on the post.
              items:
                $ref: '#/components/schemas/Comment'

    Comment:
      allOf:
        - $ref: '#/components/schemas/Content'
        - type: object
          description: A comment made on a post.
          properties:
            target:
              description: The target post of the comment.
              $ref: '#/components/schemas/Post'

    Vote:
      type: object
      description: A vote made on a post.
      properties:
        isUpVote:
          type: boolean
          description: Whether a vote is up vote or not.
        createdAt:
          type: string
          description: The time the voted was created.
          format: date-time

    Report:
      type: object
      description: A report made on a post or comment.
      properties:
        reason:
          type: string
          description: The reason for reporting the content.
        createdAt:
          type: string
          description: The time the report was created.
          format: date-time
        target:
          description: The content which was reported.
          $ref: '#/components/schemas/Content'

    ErrorResponse:
      type: object
      description: The response of an invalid HTTP request.
      properties:
        message:
          type: string
          description: A human-readable message describing the error.
        code:
          type: integer
          description: The HTTP status code.
          format: int32